# IMAP

## Формулировка
Написать скрипт, выводящий информацию о письмах в почтовом ящике

### <u>Параметры</u>:
- `-h/--help` - справка
- `--ssl` - разрешить использование ssl, если сервер поддерживает (по умолчанию не использовать).
- `-s/--server` - адрес (или доменное имя) IMAP-сервера в формате адрес[:порт] (порт по умолчанию 143).
- `-n N1 [N2]` - диапазон писем, по умолчанию все.
- `-u/--user` - имя пользователя, пароль спросить после запуска и не отображать на экране.

### <u>Итоговая оценка</u> складывается как сумма
- [1-3 балла] вывод заголовков писем как списка или таблицы с полями "кому, от кого, тема, дата, размер письма",
- [1-3 балла] декодирование заголовков From/Subject,
- [1-2 балла] работа по защищенному соединению,
- [1-2 балла] вывод количества аттачей, имен файлов и размеров.

Обязательна обработка ответов сервера, в том числе многострочных.

### Моя реализация
Данные для запуска берутся из конфиг файла json. \
C помощью регулярных выражений я проверяю заголовки, которые могут быть закодированы в формате =?UTF-8?B?BASE64DATA?  (или другой кодировке)  и перевожу их из base64 в нормальный вид. \
Я наконец то разобрался как делать правильно защищенный сокет не через ssl.wrap_socket(), а используя SSLContext. Теперь питон не ругается на использования deprecated методов \
Общение с IMAP сервером реализовано вручную, а парсинг почтовых писем частично отдан библиотеке "email". \
На выходе получаем файл output.txt c красивой таблицей с полями '№','From', 'To', 'Subject', 'Date', 'Size(in bytes)', 'Attachments'. Красивая таблица формируется библиотекой PrettyTable.

### Пример вывода
```
+---+-----------------------+-----------------------------------+------------------------+------------------------------------------+----------------+--------------------------------------------------+
| № |          From           |                 To                |        Subject         |                  Date                  | Size(in bytes) |                   Attachments                    |
+---+-----------------------+-----------------------------------+------------------------+------------------------------------------+----------------+--------------------------------------------------+
| 1 |     mail@eee-ka.ru      |           my_email@bk.ru          | Регистрация в xxxxxxxx | Sat, 14 Jul 20xx 21:32:46 +0600 (YEKT) |     1.9 kB     |                       None                       |
| 2 | Иван <passport@list.ru> | "my_email@bk.ru" <my_email@bk.ru> | Фотография на паспорт  |     Sun, 5 Aug 20xx 13:11:01 +0600     |    101.3 kB    | ID_Photo_3.5x4.5cm_5.8.xxxx_xxxxxx.jpg (72.8 kB) |
+---+-----------------------+-----------------------------------+------------------------+------------------------------------------+----------------+--------------------------------------------------+
```